!function(n){"use strict";var r={AmericanExpress:woocommerce_bluesnap_gateway_general_params.domain+"/services/hosted-payment-fields/cc-types/amex.png",DinersClub:woocommerce_bluesnap_gateway_general_params.domain+"/services/hosted-payment-fields/cc-types/diners.png",Discover:woocommerce_bluesnap_gateway_general_params.domain+"/services/hosted-payment-fields/cc-types/discover.png",JCB:woocommerce_bluesnap_gateway_general_params.domain+"/services/hosted-payment-fields/cc-types/jcb.png",MaestroUK:woocommerce_bluesnap_gateway_general_params.domain+"/services/hosted-payment-fields/cc-types/maestro.png",MasterCard:woocommerce_bluesnap_gateway_general_params.domain+"/services/hosted-payment-fields/cc-types/mastercard.png",Visa:woocommerce_bluesnap_gateway_general_params.domain+"/services/hosted-payment-fields/cc-types/visa.png",Solo:woocommerce_bluesnap_gateway_general_params.domain+"/services/hosted-payment-fields/cc-types/solo.png",CarteBleue:woocommerce_bluesnap_gateway_general_params.domain+"/services/hosted-payment-fields/cc-types/cb.png",generic:woocommerce_bluesnap_gateway_general_params.generic_card_url},a={},i=e(function(){n.ajax({url:function(e){return woocommerce_bluesnap_gateway_general_params.wc_ajax_url.toString().replace("%%endpoint%%","bluesnap_"+e)}("clear_hpf"),method:"POST"}).always(function(){n(document.body).trigger("update_checkout")})},100),c={onFieldEventHandler:{onFocus:function(e){n("[data-bluesnap='"+e+"']").removeClass("input-div-error input-div-valid")},onBlur:function(e){},onError:function(e,t,o){switch(t+""){case"14040":i()}n("[data-bluesnap='"+e+"']").addClass("input-div-error").removeClass("input-div-valid"),a[t]={tagId:e,message:woocommerce_bluesnap_gateway_general_params.errors[t]},s()},onType:function(e,t){var o=r[t];n("#card-logo > img").attr("src",o||r.generic)},onValid:function(o){n("[data-bluesnap='"+o+"']").removeClass("input-div-error").addClass("input-div-valid"),_.get_form().find('.woocommerce-NoticeGroup-checkout[data-bluesnap-tag="'+o+'"]').remove(),n.each(a,function(e,t){t.tagId===o&&delete a[e]})}},style:{".invalid":{color:"red"},":focus":{color:"inherit"}},ccnPlaceHolder:"•••• •••• •••• ••••",cvvPlaceHolder:"CVC",expDropDownSelector:!1,"3DS":o()};function e(r,n,a){var i;return function(){var e=this,t=arguments,o=a&&!i;clearTimeout(i),i=setTimeout(function(){i=null,a||r.apply(e,t)},n),o&&r.apply(e,t)}}function t(){var e=_.get_form().find(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message"),t={};return e.filter("[data-bluesnap-error]").each(function(){t[n(this).data("bluesnap-error")]=!0}),e.remove(),t}n(document.body).on("updated_checkout",function(){_.is_bluesnap_selected()&&_.init_bluesnap("updated_checkout")}),n("form#add_payment_method").on("click payment_methods",function(){_.is_bluesnap_selected()&&_.init_bluesnap()}),n("form#order_review").on("click",function(){_.is_bluesnap_selected()&&_.init_bluesnap()});var s=e(function(){var o=t(),r=!1;n.each(a,function(e,t){void 0===o[e]&&(r=!0),_.get_form().prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout" data-bluesnap-error="'+e+'" data-bluesnap-tag="'+t.tagId+'"><div class="woocommerce-error">'+t.message+"</div></div>")}),_.get_form().removeClass("processing").unblock(),_.get_form().find(".input-text, select, input:checkbox").trigger("validate").blur(),r&&function(){var e=n(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");e.length||(e=n(".form.checkout"));n.scroll_to_notices(e)}(),n(document.body).trigger("checkout_error")},100);var _={input_card_info_id:"#bluesnap_card_info",$checkout_form:n("form.woocommerce-checkout"),$add_payment_form:n("form#add_payment_method"),$order_review_form:n("form#order_review"),credentials_requested:!1,is_checkout:!1,is_order_review_form:!1,form:null,submitted:!1,init_bluesnap_counter:0,force_submit:!1,init:function(){this.$checkout_form.length&&(this.form=this.$checkout_form,this.is_checkout=!0,this.form.on("checkout_place_order",this.submit_credentials)),this.$add_payment_form.length&&(this.form=this.$add_payment_form,this.is_add_payment_method=!0,this.form.on("add_payment_method",this.submit_credentials),this.$add_payment_form.on("submit",this.add_payment_method_trigger)),this.$order_review_form.length&&(this.form=this.$order_review_form,this.is_order_review_form=!0,this.form.on("add_payment_method",this.submit_credentials),this.$order_review_form.on("submit",this.add_payment_method_trigger)),(this.is_add_payment_method||this.is_order_review_form)&&n(document.body).trigger("wc-credit-card-form-init"),this.form&&this.form.on("change",this.on_change),n("body").on("click",function(e){var t=n(e.target);if(!t.parents().andSelf().filter(".bluesnap-cvc-tooltip-trigger").length){var o=n(".bluesnap-cvc-tooltip"),r=t.parents(o);o.not(r).removeClass("bs-tooltip-visible")}})},on_change:function(){n("[name='payment_method']").on("change",function(){_.on_bluesnap_selected()})},is_bluesnap_selected:function(){return n("#payment_method_bluesnap").is(":checked")},is_bluesnap_saved_token_selected:function(){return n("#payment_method_bluesnap").is(":checked")&&n('input[name="wc-bluesnap-payment-token"]').is(":checked")&&"new"!==n('input[name="wc-bluesnap-payment-token"]:checked').val()},init_bluesnap:function(e){o()&&0===this.init_bluesnap_counter&&n("[name='woocommerce_checkout_place_order']").attr("data-bluesnap","submitButton"),this.credentials_requested&&"updated_checkout"!==e||(bluesnap.hostedPaymentFieldsCreation(woocommerce_bluesnap_gateway_general_params.token,c),this.credentials_requested=!0),n(".bluesnap-cvc-tooltip-trigger").not(".bs-tooltip-initalized").on("click",function(e){e.preventDefault(),n(this).next(".bluesnap-cvc-tooltip").toggleClass("bs-tooltip-visible")}),this.init_bluesnap_counter++},on_bluesnap_selected:function(){_.is_bluesnap_selected()?_.init_bluesnap():n("[name='woocommerce_checkout_place_order']").removeAttr("data-bluesnap")},secure_3d_field:function(e){var t=n("#"+e);return t.length&&n.trim(t.val()).length?t.val():void 0!==woocommerce_bluesnap_gateway_general_params[e]?woocommerce_bluesnap_gateway_general_params[e]:""},secure_3d_object:function(){var e={};if(o())switch((e={amount:parseFloat(woocommerce_bluesnap_gateway_general_params.total_amount),currency:woocommerce_bluesnap_gateway_general_params.currency,billingFirstName:_.secure_3d_field("billing_first_name"),billingLastName:_.secure_3d_field("billing_last_name"),billingCountry:_.secure_3d_field("billing_country"),billingState:"",billingCity:_.secure_3d_field("billing_city"),billingAddress:n.trim(_.secure_3d_field("billing_address_1")+" "+_.secure_3d_field("billing_address_2")),billingZip:_.secure_3d_field("billing_postcode"),email:_.secure_3d_field("billing_email")}).billingCountry){case"US":case"CA":e.billingState=_.secure_3d_field("billing_state")}return e},submit_credentials:function(e){if(!_.force_submit&&(e.preventDefault(),_.is_bluesnap_selected()))return _.is_order_review_form&&_.is_bluesnap_saved_token_selected()&&_.submit_form(),_.block_form(),t(),!!_.is_bluesnap_saved_token_selected()||(bluesnap.submitCredentials(function(e){if(e.cardData)_.success_callback(e.cardData);else if(e.error){var t=e.error;for(var o in t)c.onFieldEventHandler.onError.apply(c.onFieldEventHandler,[t[o].tagId,t[o].errorCode,t[o].errorDescription])}else _.error_callback()},_.secure_3d_object()),!(a={}))},add_payment_method_trigger:function(){if(!_.force_submit)return _.form.trigger("add_payment_method"),!1},success_callback:function(e){n(this.input_card_info_id).val(JSON.stringify(e)),_.submit_form()},error_callback:function(){_.submit_form(),_.unblock_form()},submit_form:function(){_.force_submit=!0,_.form.submit(),_.force_submit=!1},block_form:function(){_.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock_form:function(){_.form.unblock()},get_form:function(){return this.form}};function o(){return!!+woocommerce_bluesnap_gateway_general_params._3d_secure}n(function(){_.init()})}(jQuery);
//# sourceMappingURL=../../source/_maps/js/frontend/woocommerce-bluesnap-gateway.min.js.map
