!function(t){var n={type:"apple_pay",initialized:!1,session:null,init:function(){n.initialized||void 0!==window.ApplePaySession&&t("form.woocommerce-cart-form, form.checkout").length&&(n.initialized=!0,0!=woocommerce_bluesnap_apple_pay_params.cart_compatible_apple_pay?n.cartCanWorkWithApplePay()?ApplePaySession.canMakePayments()?(t("<style></style>").attr("id","wc-bluesnap-apple-pay-css").html("#wc-bluesnap-apple-pay-wrapper, #wc-bluesnap-apple-pay-button-separator { display: block !important; }").appendTo("body"),t(document).on("click","#wc-bluesnap-apple-pay-wrapper a.apple-pay-button",n.applePayClicked)):n.showError('<div class="woocommerce-info">'+woocommerce_bluesnap_apple_pay_params.i18n.apple_pay.not_able_to_make_payments+"</div>"):n.showError('<div class="woocommerce-info">'+woocommerce_bluesnap_apple_pay_params.i18n.apple_pay.device_not_compat_with_cart+"</div>"):n.showError('<div class="woocommerce-info">'+woocommerce_bluesnap_apple_pay_params.i18n.apple_pay.not_compatible_with_cart+"</div>"))},cartCanWorkWithApplePay:function(e){return void 0!==window.ApplePaySession&&ApplePaySession.supportsVersion(parseInt(woocommerce_bluesnap_apple_pay_params.version_required))},applePayClicked:function(e){e.preventDefault(),null===n.session&&(n.blockForm(),n.type="apple_pay",n.getRequestData().then(function(e){var o=n.session=new ApplePaySession(woocommerce_bluesnap_apple_pay_params.version_required,e);o.onvalidatemerchant=n.applePayValidateMerchant,o.onshippingcontactselected=n.applePayUpdateShippingInfo,o.onshippingmethodselected=n.applePayUpdateShippingMethod,o.onpaymentauthorized=n.applePayPaymentAuthorized,o.oncancel=n.handleCancel,o.begin()},function(){alert("Apple Pay could not be initialized. Try an alternate form of payment")}))},applePayValidateMerchant:function(e){t.ajax({url:n.getAjaxUrl("create_apple_wallet"),method:"POST",dataType:"json",data:{security:woocommerce_bluesnap_apple_pay_params.nonces.create_apple_wallet,validation_url:e.validationURL,payment_request_type:n.type}}).then(function(e){if(e.success){var o=window.atob(e.data.walletToken);n.session.completeMerchantValidation(JSON.parse(o))}else n.handleError(e)},n.handleError)},applePayUpdateShippingInfo:function(e){var o=e.shippingContact;t.ajax({url:n.getAjaxUrl("get_shipping_options"),method:"POST",dataType:"json",data:{security:woocommerce_bluesnap_apple_pay_params.nonces.get_shipping_options,address:window.btoa(JSON.stringify(o)),payment_request_type:n.type}}).then(function(e){var o=e.data;if(e.success)n.session.completeShippingContactSelection({status:ApplePaySession.STATUS_SUCCESS,newShippingMethods:o.shippingMethods,newLineItems:o.lineItems,newTotal:o.total});else{var a=new ApplePayError("shippingContactInvalid","postalAddress",o.message);n.session.completeShippingContactSelection({status:ApplePaySession.STATUS_FAILURE,errors:[a],newShippingMethods:[],newLineItems:o.lineItems,newTotal:o.total})}},n.handleError)},applePayUpdateShippingMethod:function(e){var o=e.shippingMethod;t.ajax({url:n.getAjaxUrl("update_shipping_method"),method:"POST",dataType:"json",data:{security:woocommerce_bluesnap_apple_pay_params.nonces.update_shipping_method,method:[o.identifier],payment_request_type:n.type}}).then(function(e){var o=e.data;e.success?n.session.completeShippingMethodSelection({status:ApplePaySession.STATUS_SUCCESS,newLineItems:o.lineItems,newTotal:o.total}):n.session.completeShippingMethodSelection({status:ApplePaySession.STATUS_FAILURE,newLineItems:o.lineItems,newTotal:o.total})},n.handleError)},applePayPaymentAuthorized:function(e){var o=e.payment;t.ajax({url:n.getAjaxUrl("create_apple_payment"),method:"POST",dataType:"json",data:{_wpnonce:woocommerce_bluesnap_apple_pay_params.nonces.checkout,payment_token:window.btoa(JSON.stringify(o)),payment_request_type:n.type}}).then(function(e){void 0===e.success||!1!==e.success?void 0===e.result?console.log(e):n.handleWCResponse(e):n.handleError(e)},n.handleError)},getAjaxUrl:function(e){return woocommerce_bluesnap_apple_pay_params.wc_ajax_url.toString().replace("%%endpoint%%","bluesnap_"+e)},getRequestData:function(){var o=t.Deferred();return t.ajax({url:n.getAjaxUrl("get_payment_request"),method:"POST",dataType:"json",data:{security:woocommerce_bluesnap_apple_pay_params.nonces.get_payment_request,payment_request_type:n.type},async:!1}).done(function(e){e.success?o.resolve(e.data):o.reject()}).fail(function(){o.reject()}),o.promise()},handleError:function(e){switch(n.type){case"apple_pay":n.session.completePayment(ApplePaySession.STATUS_FAILURE)}n.session=null,n.unblockForm(),t(document.body).trigger("update_checkout")},handleSuccess:function(){switch(n.type){case"apple_pay":n.session.completePayment(ApplePaySession.STATUS_SUCCESS)}n.session=null},handleCancel:function(){n.type,n.session=null,n.unblockForm(),t(document.body).trigger("update_checkout")},handleWCResponse:function(o){try{if("success"!==o.result)throw"failure"===o.result?"Result failure":"Invalid response";n.handleSuccess(),-1===o.redirect.indexOf("https://")||-1===o.redirect.indexOf("http://")?window.location=o.redirect:window.location=decodeURI(o.redirect)}catch(e){if(!0===o.reload)return void window.location.reload();!0===o.refresh&&t(document.body).trigger("update_checkout"),o.messages?n.showError(o.messages):n.showError('<div class="woocommerce-error">'+woocommerce_bluesnap_apple_pay_params.i18n.checkout_error+"</div>")}},getForm:function(){var e=t("form.woocommerce-checkout");return e.length||(e=t("form#add_payment_method")),e.length||(e=t("form#order_review")),e.length||(e=t("form.woocommerce-cart-form")).length&&(e=e.closest(".woocommerce")),e},blockForm:function(){n.getForm().addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblockForm:function(){n.getForm().removeClass("processing").unblock()},showError:function(e){var o=n.getForm();if(o.length){t(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),o.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>"),n.unblockForm();var a=t(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");a.length||(a=t(o)),t.scroll_to_notices(a),t(document.body).trigger("checkout_error")}else console.error(e)}};t(document.body).on("updated_checkout",function(){n.init()}),t(n.init)}(jQuery);
//# sourceMappingURL=../../source/_maps/js/frontend/woocommerce-bluesnap-apple-pay.min.js.map
