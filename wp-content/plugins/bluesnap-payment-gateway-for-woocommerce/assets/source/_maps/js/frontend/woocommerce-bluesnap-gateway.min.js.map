{"version":3,"sources":["frontend/woocommerce-bluesnap-gateway.js"],"names":["$","card_thumbs","AmericanExpress","woocommerce_bluesnap_gateway_general_params","domain","DinersClub","Discover","JCB","MaestroUK","MasterCard","Visa","Solo","CarteBleue","generic","generic_card_url","validation_messages","clear_token_fn","debounce","ajax","url","method","wc_ajax_url","toString","replace","getAjaxUrl","always","document","body","trigger","bsObj","onFieldEventHandler","onFocus","tagId","removeClass","onBlur","onError","errorCode","errorDescription","addClass","message","errors","submit_error_efficient","onType","cardType","card_url","attr","onValid","wc_bluesnap_form","get_form","find","remove","each","data","style",".invalid","color",":focus","ccnPlaceHolder","cvvPlaceHolder","expDropDownSelector","3DS","is_3d_secure","func","wait","immediate","timeout","context","this","args","arguments","callNow","clearTimeout","setTimeout","apply","clear_errors","code","filter","on","is_bluesnap_selected","init_bluesnap","codes","scroll","prepend","unblock","blur","scroll_element","length","scroll_to_notices","input_card_info_id","$checkout_form","$add_payment_form","$order_review_form","credentials_requested","is_checkout","is_order_review_form","form","submitted","init_bluesnap_counter","force_submit","init","submit_credentials","is_add_payment_method","add_payment_method_trigger","on_change","e","$target","target","parents","andSelf","$tooltips","$thisParents","not","on_bluesnap_selected","is","is_bluesnap_saved_token_selected","val","event","bluesnap","hostedPaymentFieldsCreation","token","preventDefault","next","toggleClass","removeAttr","secure_3d_field","id","field","trim","secure_3d_object","threeDSecureObj","amount","parseFloat","total_amount","currency","billingFirstName","billingLastName","billingCountry","billingState","billingCity","billingAddress","billingZip","email","submit_form","block_form","submitCredentials","res","cardData","success_callback","error","errorArray","i","error_callback","JSON","stringify","unblock_form","submit","block","overlayCSS","background","opacity","_3d_secure","jQuery"],"mappings":"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","file":"../../../../js/frontend/woocommerce-bluesnap-gateway.min.js","sourcesContent":["(function( $ ) {\n\t'use strict';\n\n\tvar card_thumbs = {\n\t\t'AmericanExpress': woocommerce_bluesnap_gateway_general_params.domain + '/services/hosted-payment-fields/cc-types/amex.png',\n\t\t'DinersClub': woocommerce_bluesnap_gateway_general_params.domain + '/services/hosted-payment-fields/cc-types/diners.png',\n\t\t'Discover': woocommerce_bluesnap_gateway_general_params.domain + '/services/hosted-payment-fields/cc-types/discover.png',\n\t\t'JCB': woocommerce_bluesnap_gateway_general_params.domain + '/services/hosted-payment-fields/cc-types/jcb.png',\n\t\t'MaestroUK': woocommerce_bluesnap_gateway_general_params.domain + '/services/hosted-payment-fields/cc-types/maestro.png',\n\t\t'MasterCard': woocommerce_bluesnap_gateway_general_params.domain + '/services/hosted-payment-fields/cc-types/mastercard.png',\n\t\t'Visa': woocommerce_bluesnap_gateway_general_params.domain + '/services/hosted-payment-fields/cc-types/visa.png',\n\t\t'Solo': woocommerce_bluesnap_gateway_general_params.domain + '/services/hosted-payment-fields/cc-types/solo.png',\n\t\t'CarteBleue': woocommerce_bluesnap_gateway_general_params.domain + '/services/hosted-payment-fields/cc-types/cb.png',\n\t\t'generic' : woocommerce_bluesnap_gateway_general_params.generic_card_url\n\t};\n\n\t// Holds all validation messages from Bluesnap.\n\tvar validation_messages = {};\n\n\tvar clear_token_fn = debounce(function(){\n\t\t$.ajax(\n\t\t\t{\n\t\t\t\turl: getAjaxUrl('clear_hpf'),\n\t\t\t\tmethod: \"POST\",\n\t\t\t}\n\t\t).always(function(){\n\t\t\t$( document.body ).trigger( 'update_checkout' );\n\t\t});\n\t}, 100);\n\n\tvar bsObj = {\n\t\tonFieldEventHandler: {\n\t\t\tonFocus: function(tagId) {\n\t\t\t\t$( \"[data-bluesnap='\" + tagId + \"']\" ).removeClass('input-div-error input-div-valid');\n\t\t\t},\n\t\t\tonBlur: function(tagId) {\n\t\t\t},\n\t\t\tonError: function(tagId, errorCode, errorDescription) {\n\t\t\t\tswitch( errorCode + '' ) {\n\t\t\t\t\tcase '14040':\n\t\t\t\t\t\tclear_token_fn();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t$( \"[data-bluesnap='\" + tagId + \"']\" ).addClass('input-div-error').removeClass('input-div-valid');\n\t\t\t\tvalidation_messages[errorCode] = {\n\t\t\t\t\ttagId: tagId,\n\t\t\t\t\tmessage: woocommerce_bluesnap_gateway_general_params.errors[errorCode]\n\t\t\t\t};\n\t\t\t\tsubmit_error_efficient();\n\t\t\t},\n\t\t\tonType: function(tagId, cardType) {\n\t\t\t\tvar card_url = card_thumbs[cardType];\n\t\t\t\t$( \"#card-logo > img\" ).attr( \"src\", (card_url) ? card_url : card_thumbs['generic'] );\n\t\t\t},\n\t\t\tonValid: function(tagId) {\n\t\t\t\t$( \"[data-bluesnap='\" + tagId + \"']\" ).removeClass('input-div-error').addClass('input-div-valid');\n\t\t\t\twc_bluesnap_form.get_form().find( '.woocommerce-NoticeGroup-checkout[data-bluesnap-tag=\"' + tagId + '\"]' ).remove();\n\t\t\t\t$.each(validation_messages, function(errorCode, data) {\n\t\t\t\t\tif(data.tagId === tagId) {\n\t\t\t\t\t\tdelete validation_messages[errorCode];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tstyle: {\n\t\t\t\".invalid\": {\n\t\t\t\t\"color\": \"red\"\n\t\t\t},\n\t\t\t\":focus\": {\n\t\t\t\t\"color\": \"inherit\"\n\t\t\t}\n\t\t},\n\t\tccnPlaceHolder: \"•••• •••• •••• ••••\",\n\t\tcvvPlaceHolder: \"CVC\",\n\t\texpDropDownSelector: false,\n\t\t'3DS': is_3d_secure()\n\t};\n\n\t// On Checkout form.\n\t$( document.body ).on(\n\t\t'updated_checkout', function() {\n\t\t\t// If is bluesnap method checked, init it.\n\t\t\tif (wc_bluesnap_form.is_bluesnap_selected()) {\n\t\t\t\twc_bluesnap_form.init_bluesnap( 'updated_checkout' );\n\t\t\t}\n\t\t}\n\t);\n\n\t// On Add Payment Method form.\n\t$( 'form#add_payment_method' ).on(\n\t\t'click payment_methods', function() {\n\t\t\tif (wc_bluesnap_form.is_bluesnap_selected()) {\n\t\t\t\twc_bluesnap_form.init_bluesnap();\n\t\t\t}\n\t\t}\n\t);\n\n\t// On Pay for order form.\n\t$( 'form#order_review' ).on(\n\t\t'click', function() {\n\t\t\tif (wc_bluesnap_form.is_bluesnap_selected()) {\n\t\t\t\twc_bluesnap_form.init_bluesnap();\n\t\t\t}\n\t\t}\n\t);\n\n\tfunction debounce(func, wait, immediate) {\n\t\tvar timeout;\n\t\treturn function() {\n\t\t\tvar context = this, args = arguments;\n\t\t\tvar later = function() {\n\t\t\t\ttimeout = null;\n\t\t\t\tif (!immediate) func.apply(context, args);\n\t\t\t};\n\t\t\tvar callNow = immediate && !timeout;\n\t\t\tclearTimeout(timeout);\n\t\t\ttimeout = setTimeout(later, wait);\n\t\t\tif (callNow) func.apply(context, args);\n\t\t};\n\t};\n\n\tfunction getAjaxUrl(method) {\n\t\treturn woocommerce_bluesnap_gateway_general_params.wc_ajax_url.toString().replace( '%%endpoint%%', 'bluesnap_' + method )\n\t}\n\n\tfunction clear_errors() {\n\t\tvar errors = wc_bluesnap_form.get_form().find( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' );\n\t\tvar code = {};\n\t\terrors.filter(\"[data-bluesnap-error]\").each(function(){\n\t\t\tcode[$(this).data('bluesnap-error')] = true;\n\t\t})\n\t\terrors.remove();\n\t\treturn code;\n\t}\n\n\tfunction submit_error() {\n\t\tvar codes = clear_errors();\n\t\tvar scroll = false;\n\t\t$.each(\n\t\t\tvalidation_messages, function(errorCode, data) {\n\t\t\t\tif( typeof codes[errorCode] === \"undefined\" ) {\n\t\t\t\t\tscroll = true;\n\t\t\t\t}\n\t\t\t\twc_bluesnap_form.get_form().prepend( '<div class=\"woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout\" data-bluesnap-error=\"' + errorCode + '\" data-bluesnap-tag=\"' + data.tagId + '\"><div class=\"woocommerce-error\">' + data.message + '</div></div>' );\n\t\t\t}\n\t\t);\n\t\twc_bluesnap_form.get_form().removeClass( 'processing' ).unblock();\n\t\twc_bluesnap_form.get_form().find( '.input-text, select, input:checkbox' ).trigger( 'validate' ).blur();\n\t\tif( scroll ) {\n\t\t\tscroll_to_notices();\n\t\t}\n\t\t$( document.body ).trigger( 'checkout_error' );\n\t}\n\n\tvar submit_error_efficient = debounce(submit_error, 100);\n\n\tfunction scroll_to_notices() {\n\t\tvar scroll_element = $( '.woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout' );\n\t\tif ( ! scroll_element.length ) {\n\t\t\tscroll_element = $( '.form.checkout' );\n\t\t}\n\t\t$.scroll_to_notices( scroll_element );\n\t}\n\n\t/**\n\t * Object to handle bluesnap wc forms.\n\t * @type {{input_card_info_id: string, $checkout_form: (*|HTMLElement), $add_payment_form: (*|HTMLElement), credentials_requested: boolean, form: boolean, init: init, on_change: on_change, is_bluesnap_selected: (function(): *), init_bluesnap: init_bluesnap, on_bluesnap_selected: on_bluesnap_selected, secure_3d_object: (function()), submit_credentials: (function(): boolean), success_callback: success_callback, error_callback: error_callback, submit_form: submit_form, block_form: block_form, unblock_form: unblock_form, get_form: (function(): (*|HTMLElement))}}\n\t */\n\tvar wc_bluesnap_form = {\n\t\tinput_card_info_id : '#bluesnap_card_info',\n\t\t$checkout_form: $( 'form.woocommerce-checkout' ),\n\t\t$add_payment_form: $( 'form#add_payment_method' ),\n\t\t$order_review_form: $( 'form#order_review' ),\n\t\tcredentials_requested: false,\n\t\tis_checkout: false,\n\t\tis_order_review_form: false,\n\t\tform: null,\n\t\tsubmitted: false,\n\t\tinit_bluesnap_counter: 0,\n\t\tforce_submit: false, \n\t\t/**\n\t\t * Interrupts normal checkout flow. Delay submission.\n\t\t */\n\t\tinit: function() {\n\t\t\t// Checkout Page\n\t\t\tif ( this.$checkout_form.length ) {\n\t\t\t\tthis.form        = this.$checkout_form;\n\t\t\t\tthis.is_checkout = true;\n\t\t\t\tthis.form.on( 'checkout_place_order', this.submit_credentials );\n\t\t\t}\n\n\t\t\t// Add payment Page\n\t\t\tif ( this.$add_payment_form.length ) {\n\t\t\t\tthis.form                  = this.$add_payment_form;\n\t\t\t\tthis.is_add_payment_method = true;\n\t\t\t\tthis.form.on( 'add_payment_method', this.submit_credentials );\n\t\t\t\tthis.$add_payment_form.on( 'submit', this.add_payment_method_trigger );\n\t\t\t}\n\n\t\t\t// Pay for order Page (change subs method)\n\t\t\tif ( this.$order_review_form.length ) {\n\t\t\t\tthis.form                 = this.$order_review_form;\n\t\t\t\tthis.is_order_review_form = true;\n\t\t\t\tthis.form.on( 'add_payment_method', this.submit_credentials );\n\t\t\t\tthis.$order_review_form.on( 'submit', this.add_payment_method_trigger );\n\t\t\t}\n\n\t\t\t// tokenization script initiation for change payment method page and pay for order page.\n\t\t\tif (this.is_add_payment_method || this.is_order_review_form) {\n\t\t\t\t$( document.body ).trigger( 'wc-credit-card-form-init' );\n\t\t\t}\n\n\t\t\tif (this.form) {\n\t\t\t\tthis.form.on( 'change', this.on_change );\n\t\t\t}\n\n\t\t\t$('body').on('click', function(e) {\n\t\t\t\tvar $target = $( e.target );\n\t\t\t\tif( $target.parents().andSelf().filter('.bluesnap-cvc-tooltip-trigger').length ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar $tooltips = $('.bluesnap-cvc-tooltip');\n\t\t\t\tvar $thisParents = $target.parents( $tooltips );\n\t\t\t\t$tooltips.not( $thisParents ).removeClass('bs-tooltip-visible')\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Triggered on form changes.\n\t\t */\n\t\ton_change: function() {\n\t\t\t$( \"[name='payment_method']\" ).on(\n\t\t\t\t'change', function() {\n\t\t\t\t\twc_bluesnap_form.on_bluesnap_selected();\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\t/**\n\t\t * Checks if input bluesnap is checked.\n\t\t * @returns bool\n\t\t */\n\t\tis_bluesnap_selected: function() {\n\t\t\treturn $( '#payment_method_bluesnap' ).is( \":checked\" );\n\t\t},\n\t\tis_bluesnap_saved_token_selected: function() {\n\t\t\treturn ( $( '#payment_method_bluesnap' ).is( ':checked' ) && ( $( 'input[name=\"wc-bluesnap-payment-token\"]' ).is( ':checked' ) && 'new' !== $( 'input[name=\"wc-bluesnap-payment-token\"]:checked' ).val() ) );\n\t\t},\n\t\t/**\n\t\t * Trigger BlueSnap authentication.\n\t\t * @param event\n\t\t */\n\t\tinit_bluesnap: function( event ) {\n\t\t\t// Only add attribute first time we show the form\n\t\t\tif (is_3d_secure() && this.init_bluesnap_counter === 0) {\n\t\t\t\t$( \"[name='woocommerce_checkout_place_order']\" ).attr( 'data-bluesnap', 'submitButton' );\n\t\t\t}\n\n\t\t\tif ( ! this.credentials_requested || 'updated_checkout' === event) {\n\t\t\t\tbluesnap.hostedPaymentFieldsCreation( woocommerce_bluesnap_gateway_general_params.token, bsObj );\n\t\t\t\tthis.credentials_requested = true;\n\t\t\t}\n\n\t\t\t$('.bluesnap-cvc-tooltip-trigger').not('.bs-tooltip-initalized').on('click', function(e){\n\t\t\t\te.preventDefault();\n\t\t\t\t$(this).next('.bluesnap-cvc-tooltip').toggleClass('bs-tooltip-visible');\n\t\t\t});\n\t\t\t// init_bluesnap can be triggered multiple times.\n\t\t\tthis.init_bluesnap_counter++;\n\t\t},\n\t\t/**\n\t\t * Triggered when BlueSnap is selected from the payment list.\n\t\t */\n\t\ton_bluesnap_selected: function() {\n\t\t\tif (wc_bluesnap_form.is_bluesnap_selected()) {\n\t\t\t\twc_bluesnap_form.init_bluesnap();\n\t\t\t} else {\n\t\t\t\t$( \"[name='woocommerce_checkout_place_order']\" ).removeAttr( 'data-bluesnap' );\n\t\t\t}\n\t\t},\n\n\t\tsecure_3d_field: function(id) {\n\t\t\tvar field = $( '#' + id );\n\t\t\tif( field.length && $.trim( field.val() ).length ) {\n\t\t\t\treturn field.val();\n\t\t\t} else if (typeof woocommerce_bluesnap_gateway_general_params[id] !== 'undefined' ) {\n\t\t\t\treturn woocommerce_bluesnap_gateway_general_params[id];\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * 3D Secure Object with transaction data.\n\t\t */\n\t\tsecure_3d_object: function() {\n\t\t\tvar threeDSecureObj = {};\n\t\t\tif (is_3d_secure()) {\n\t\t\t\tthreeDSecureObj = {\n\t\t\t\t\t'amount' : parseFloat( woocommerce_bluesnap_gateway_general_params.total_amount ),\n\t\t\t\t\t'currency' : woocommerce_bluesnap_gateway_general_params.currency,\n\t\t\t\t\t'billingFirstName' : wc_bluesnap_form.secure_3d_field( 'billing_first_name' ),\n\t\t\t\t\t'billingLastName' : wc_bluesnap_form.secure_3d_field( 'billing_last_name' ),\n\t\t\t\t\t'billingCountry' : wc_bluesnap_form.secure_3d_field( 'billing_country' ),\n\t\t\t\t\t'billingState' : '',\n\t\t\t\t\t'billingCity' : wc_bluesnap_form.secure_3d_field( 'billing_city' ),\n\t\t\t\t\t'billingAddress' : $.trim( wc_bluesnap_form.secure_3d_field( 'billing_address_1' ) + ' ' + wc_bluesnap_form.secure_3d_field( 'billing_address_2' ) ),\n\t\t\t\t\t'billingZip' : wc_bluesnap_form.secure_3d_field( 'billing_postcode' ),\n\t\t\t\t\t'email' : wc_bluesnap_form.secure_3d_field( 'billing_email' ),\n\t\t\t\t};\n\n\t\t\t\tswitch( threeDSecureObj.billingCountry ) {\n\t\t\t\t\tcase 'US':\n\t\t\t\t\tcase 'CA':\n\t\t\t\t\t\tthreeDSecureObj.billingState = wc_bluesnap_form.secure_3d_field( 'billing_state' );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn threeDSecureObj;\n\t\t},\n\t\t/**\n\t\t * Submitting Credentials to BlueSnap.\n\t\t * @returns {boolean}\n\t\t */\n\t\tsubmit_credentials: function(e) {\n\t\t\tif( wc_bluesnap_form.force_submit ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.preventDefault();\n\n\t\t\tif ( ! wc_bluesnap_form.is_bluesnap_selected()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (wc_bluesnap_form.is_order_review_form && wc_bluesnap_form.is_bluesnap_saved_token_selected()) {\n\t\t\t\twc_bluesnap_form.submit_form();\n\t\t\t}\n\n\t\t\twc_bluesnap_form.block_form();\n\t\t\tclear_errors();\n\n\t\t\tif ( wc_bluesnap_form.is_bluesnap_saved_token_selected() ) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tbluesnap.submitCredentials(\n\t\t\t\tfunction(res) {\n\t\t\t\t\tif (res.cardData) {\n\t\t\t\t\t\twc_bluesnap_form.success_callback( res.cardData );\n\t\t\t\t\t} else if( res.error ) {\n\t\t\t\t\t\tvar errorArray = res.error;\n\t\t\t\t\t\tfor (var i in errorArray) {\n\t\t\t\t\t\t\tbsObj.onFieldEventHandler.onError.apply(bsObj.onFieldEventHandler, [errorArray[i].tagId, errorArray[i].errorCode, errorArray[i].errorDescription])\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\twc_bluesnap_form.error_callback();\n\t\t\t\t\t}\n\t\t\t\t}, wc_bluesnap_form.secure_3d_object()\n\t\t\t);\n\t\t\tvalidation_messages = {};\n\t\t\treturn false;\n\t\t},\n\t\tadd_payment_method_trigger: function() {\n\t\t\tif( wc_bluesnap_form.force_submit ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\twc_bluesnap_form.form.trigger( 'add_payment_method' );\n\t\t\treturn false;\n\t\t},\n\t\t/**\n\t\t * Callback on Success to set credentials into checkout form.\n\t\t * @param data\n\t\t */\n\t\tsuccess_callback : function( data ) {\n\t\t\t$( this.input_card_info_id ).val( JSON.stringify( data ) );\n\t\t\twc_bluesnap_form.submit_form();\n\t\t},\n\t\t/**\n\t\t * Callback on Failure.\n\t\t * Submit formal as normal and reset it.\n\t\t */\n\t\terror_callback: function() {\n\t\t\twc_bluesnap_form.submit_form();\n\t\t\twc_bluesnap_form.unblock_form();\n\t\t},\n\t\t/**\n\t\t * Deactivate submit_credentials function event and submit the form again.\n\t\t */\n\t\tsubmit_form: function() {\n\t\t\twc_bluesnap_form.force_submit = true;\n\t\t\twc_bluesnap_form.form.submit();\n\t\t\twc_bluesnap_form.force_submit = false;\n\t\t},\n\t\tblock_form: function() {\n\t\t\twc_bluesnap_form.form.block( {\n\t\t\t\tmessage: null,\n\t\t\t\toverlayCSS: {\n\t\t\t\t\tbackground: '#fff',\n\t\t\t\t\topacity: 0.6\n\t\t\t\t}\n\t\t\t} );\n\t\t},\n\t\tunblock_form: function() {\n\t\t\twc_bluesnap_form.form.unblock();\n\t\t},\n\t\t/**\n\t\t * Form Element getter.\n\t\t * @returns {*|HTMLElement}\n\t\t */\n\t\tget_form: function() {\n\t\t\treturn this.form;\n\t\t}\n\t};\n\n\t$(\n\t\tfunction() {\n\t\t\t\twc_bluesnap_form.init();\n\t\t}\n\t);\n\n\t/**\n\t * @returns {boolean}\n\t */\n\tfunction is_3d_secure() {\n\t\treturn ! ! + woocommerce_bluesnap_gateway_general_params._3d_secure;\n\t}\n\n\t/**\n\t * @returns {boolean}\n\t */\n\tfunction is_sandbox() {\n\t\treturn ! ! + woocommerce_bluesnap_gateway_general_params.is_sandbox;\n\t}\n\n})( jQuery );\n\n//# sourceMappingURL=../../source/_maps/js/frontend/woocommerce-bluesnap-gateway.js.map\n"]}